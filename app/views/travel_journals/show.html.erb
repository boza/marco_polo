<div>
  <h3><%= @travel_journal.title%></h3>
  <h4>Start Date: <%= @travel_journal.start_date %></h4>
</div>
<div id="map-wrapper" data-locations="<%= @travel_journal.locations.to_json(only: [:lat, :lng, :address]) %>">
  <div id="map-canvas"></div>
</div>

<a href="#" data-reveal-id="locationForm">Add a new location</a>

<div id="locationForm" class="reveal-modal" data-reveal>
  <%= simple_form_for [@travel_journal, @travel_journal.locations.build], remote: true  do |form| %>
    <%= form.input :address, placeholder: '48 Lower Mount Street Dublin 2, Ireland' %>
    <%= form.submit %>
  <% end %>
</div>


<script type="text/javascript">
  
  function initialize() {
    var mapOptions = {};

    var mapWrapper = $('#map-wrapper')
    var locations  = mapWrapper.data('locations')

    var map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);
    var bounds = new google.maps.LatLngBounds();


    for (var i = 0; i < locations.length; i++) {
      var location = locations[i];
      var marker = new google.maps.Marker({
      position: new google.maps.LatLng(location.lat, location.lng),
      map: map,
      animation: google.maps.Animation.DROP,
      title: location.address
      });
      bounds.extend(marker.getPosition());
    };
    
    if (locations.length > 0) {
      map.fitBounds(bounds);
    } else {
      map.setZoom(4)
    }
  }
  google.maps.event.addDomListener(window, 'load', initialize);  

</script>